<div class="container py-4">
  @switch (state()) {
    @case ('loading') {
      <div class="d-flex justify-content-center py-5">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    }

    @case ('error') {
      <div class="error-state text-center py-5">
        <mat-icon class="icon-lg mb-3 text-danger">error_outline</mat-icon>
        <h2>Something went wrong</h2>
        <p class="opacity-75 mb-4">We couldn't load this profile.</p>
        <button mat-stroked-button (click)="goHome()">Go Home</button>
      </div>
    }

    @case ('not-found') {
      <div class="not-found-state text-center py-5">
        <mat-icon class="icon-lg mb-3 opacity-50">person_off</mat-icon>
        <h2>User not found</h2>
        <p class="opacity-75 mb-4">The user <strong>{{ usernameParam() }}</strong> does not exist or has changed their username.</p>
        <button mat-stroked-button (click)="goHome()">Go Home</button>
      </div>
    }

    @case ('loaded') {
      @if (isPrivate() && !isOwnProfile()) {
        <!-- Private Profile View -->
        <div class="private-state text-center py-5">
          <mat-icon class="icon-lg mb-3 opacity-50">lock</mat-icon>
          <h2>This profile is private</h2>
          <p class="opacity-75 mb-4">This user has chosen to keep their profile hidden.</p>
          <button mat-stroked-button (click)="goHome()">Go Home</button>
        </div>
      } @else {
        <!-- Public Profile View -->
        <mat-card class="profile-card mx-auto" style="max-width: 600px;">
          <!-- Header / Actions -->
          <div class="d-flex justify-content-end p-2 pb-0">
             <button mat-icon-button (click)="copyLink()" matTooltip="Copy Link">
               <mat-icon>link</mat-icon>
             </button>
             @if (isOwnProfile()) {
               <a mat-icon-button routerLink="/profile" matTooltip="Edit Profile">
                 <mat-icon>edit</mat-icon>
               </a>
             }
          </div>

          <div class="p-4 pt-0">
            <!-- Identity -->
            <div class="text-center mb-4">
               <div class="avatar-placeholder mb-3 mx-auto">
                 <mat-icon class="icon-xl">person</mat-icon>
               </div>
               <h1 class="m-0">{{ profile()?.username }}</h1>
               
               @if (profile()?.sings) {
                 <div class="mt-2">
                   <span class="badge-sings">ðŸŽ¤ Sings</span>
                 </div>
               }
            </div>

            <!-- Bio -->
            @if (profile()?.about; as about) {
              <div class="mb-4 text-center">
                <p class="about-text multiline-text">{{ about }}</p>
              </div>
            }

            <hr class="opacity-10 my-4" />

            <!-- Instruments -->
            <div class="mb-4">
              <h3 class="h6 text-uppercase opacity-50 mb-3 small fw-bold text-center">Instruments</h3>
              @if (profile()?.instruments?.length) {
                <div class="d-flex gap-2 flex-wrap justify-content-center">
                  @for (inst of profile()?.instruments; track inst) {
                    <div class="pill-chip">{{ inst }}</div>
                  }
                </div>
              } @else {
                <p class="text-center small opacity-50">No instruments listed.</p>
              }
            </div>

            <!-- Genres -->
            <div>
              <h3 class="h6 text-uppercase opacity-50 mb-3 small fw-bold text-center">Genres</h3>
              @if (profile()?.genres?.length) {
                <div class="d-flex gap-2 flex-wrap justify-content-center">
                  @for (genre of profile()?.genres; track genre) {
                    <div class="pill-chip pill-chip--secondary">{{ genre }}</div>
                  }
                </div>
              } @else {
                <p class="text-center small opacity-50">No genres listed.</p>
              }
            </div>

          </div>
        </mat-card>
      }
    }
  }
</div>
