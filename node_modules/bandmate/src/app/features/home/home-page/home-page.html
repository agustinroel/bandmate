<header class="bm-page-header">
  <div class="d-flex align-items-start gap-3">
    <div class="bm-mark" aria-hidden="true">
      <mat-icon>home</mat-icon>
    </div>

    <div class="flex-grow-1 min-w-0">
      <h2 class="m-0">Home</h2>
      <div class="small opacity-75 mt-1">Your rehearsal-ready workspace.</div>
    </div>
  </div>
</header>

@if (showOnboarding()) {
  <section class="bm-fr mb-4" aria-label="Welcome to Bandmate">
    <div class="bm-fr__left">
      <div class="bm-fr__badge">
        <mat-icon class="bm-fr__badge-ic">auto_awesome</mat-icon>
        <span>First run</span>
      </div>

      <h2 class="bm-fr__title">Welcome to Bandmate</h2>

      <p class="bm-fr__desc">
        Your digital stage is ready. Start by organizing your repertoire or creating your first
        setlist.
      </p>

      <p class="bm-fr__sub">Tip: Seed famous songs to try out the new features quickly.</p>

      <div class="bm-fr__actions">
        <a mat-raised-button color="primary" routerLink="/songs/new">
          <mat-icon class="me-1">add</mat-icon>
          Create your first song
        </a>

        <!-- Restored button -->
        <button mat-stroked-button type="button" (click)="seedLibrary()">
          <mat-icon class="me-1">library_music</mat-icon>
          Seed famous songs
        </button>
      </div>
    </div>

    <!-- Visual decoration reused from FR style -->
    <div class="bm-fr__right" aria-hidden="true">
      <div class="bm-fr__card">
        <div class="bm-fr__row">
          <span class="bm-fr__pill">[Am]</span>
          <span class="bm-fr__pill">[F]</span>
          <span class="bm-fr__pill">[C]</span>
        </div>
        <div class="bm-fr__row bm-fr__row--muted">
          <span class="bm-fr__line"></span>
          <span class="bm-fr__line"></span>
        </div>
        <div class="bm-fr__row">
          <span class="bm-fr__pill">Practice</span>
          <span class="bm-fr__pill">Transpose</span>
        </div>
      </div>
    </div>

    <button
      mat-icon-button
      class="position-absolute top-0 end-0 m-2 opacity-50"
      (click)="dismissOnboarding()"
      title="Dismiss"
    >
      <mat-icon>close</mat-icon>
    </button>
  </section>
}

<div class="bm-home-grid">
  <mat-card class="bm-card">
    <div class="bm-card-inner">
      <div class="bm-card-title">Songs</div>
      <div class="bm-card-sub small opacity-75">Create, edit and organize your library.</div>
      <div class="bm-card-actions">
        <a mat-stroked-button color="primary" routerLink="/songs">
          <mat-icon class="bm-btn-ic">music_note</mat-icon>
          Open songs
        </a>
        <a mat-button routerLink="/songs/new">New song</a>
      </div>
    </div>
  </mat-card>

  <mat-card class="bm-card">
    <div class="bm-card-inner">
      <div class="bm-card-title">Setlists</div>
      <div class="bm-card-sub small opacity-75">Group songs and order them for gigs.</div>
      <div class="bm-card-actions">
        <a mat-stroked-button color="primary" routerLink="/setlists">
          <mat-icon class="bm-btn-ic">queue_music</mat-icon>
          Open setlists
        </a>
      </div>
    </div>
  </mat-card>

  <mat-card class="bm-card">
    <div class="bm-card-inner">
      <div class="bm-card-title">Practice</div>
      <div class="bm-card-sub small opacity-75">Minimal practice tools (MVP placeholders).</div>
      <div class="bm-card-actions">
        <a mat-stroked-button color="primary" routerLink="/practice">
          <mat-icon class="bm-btn-ic">fitness_center</mat-icon>
          Open practice
        </a>
      </div>
    </div>
  </mat-card>
</div>

<!-- Practice Statistics Section -->
<section class="bm-stats-section" aria-label="Practice Statistics">
  <h3 class="bm-section-title">
    <mat-icon class="bm-section-icon">insights</mat-icon>
    Practice Stats
  </h3>

  @if (practiceStats.isLoading()) {
    <div class="bm-stats-loading">
      <mat-spinner diameter="32"></mat-spinner>
    </div>
  } @else {
    <div class="bm-stats-grid">
      <!-- This Week Card -->
      <mat-card class="bm-stat-card bm-stat-primary">
        <div class="bm-stat-icon">
          <mat-icon>schedule</mat-icon>
        </div>
        <div class="bm-stat-content">
          <div class="bm-stat-value">
            {{ practiceStats.formatDuration(practiceStats.summary()?.week?.totalSeconds || 0) }}
          </div>
          <div class="bm-stat-label">This Week</div>
        </div>
        <div class="bm-stat-detail">
          {{ practiceStats.summary()?.week?.sessionCount || 0 }} sessions
        </div>
      </mat-card>

      <!-- Today Card -->
      <mat-card class="bm-stat-card">
        <div class="bm-stat-icon">
          <mat-icon>today</mat-icon>
        </div>
        <div class="bm-stat-content">
          <div class="bm-stat-value">
            {{ practiceStats.formatDuration(practiceStats.summary()?.today?.totalSeconds || 0) }}
          </div>
          <div class="bm-stat-label">Today</div>
        </div>
      </mat-card>

      <!-- Streak Card -->
      <mat-card class="bm-stat-card bm-stat-streak">
        <div class="bm-stat-icon">
          <mat-icon>local_fire_department</mat-icon>
        </div>
        <div class="bm-stat-content">
          <div class="bm-stat-value">{{ practiceStats.streak() }}</div>
          <div class="bm-stat-label">Day Streak</div>
        </div>
      </mat-card>

      <!-- All Time Card -->
      <mat-card class="bm-stat-card">
        <div class="bm-stat-icon">
          <mat-icon>emoji_events</mat-icon>
        </div>
        <div class="bm-stat-content">
          <div class="bm-stat-value">
            {{ practiceStats.formatDuration(practiceStats.summary()?.all?.totalSeconds || 0) }}
          </div>
          <div class="bm-stat-label">All Time</div>
        </div>
        <div class="bm-stat-detail">
          {{ practiceStats.summary()?.all?.songsCount || 0 }} songs practiced
        </div>
      </mat-card>
    </div>

    <!-- Most Practiced Songs -->
    @if (practiceStats.mostPracticed().length > 0) {
      <div class="bm-top-songs">
        <h4 class="bm-subsection-title">Most Practiced</h4>
        <div class="bm-top-songs-list">
          @for (song of practiceStats.mostPracticed(); track song.id; let i = $index) {
            <div class="bm-top-song-item">
              <span class="bm-top-song-rank">{{ i + 1 }}</span>
              <div class="bm-top-song-info">
                <div class="bm-top-song-title">{{ song.title }}</div>
                <div class="bm-top-song-artist">{{ song.artist }}</div>
              </div>
              <div class="bm-top-song-count">{{ song.practice_count }}Ã—</div>
            </div>
          }
        </div>
      </div>
    }
  }
</section>

<!-- Achievements Section -->
@if (achievements.userAchievements().length > 0) {
  <section class="bm-achievements-section mt-5" aria-label="Unlocked Achievements">
    <h3 class="bm-section-title">
      <mat-icon class="bm-section-icon" style="color: #e9c46a">workspace_premium</mat-icon>
      Achievements
    </h3>

    <div class="bm-achievements-grid">
      @for (achievement of achievements.userAchievements(); track achievement.id) {
        <app-achievement-card [achievement]="achievement" />
      }
    </div>
  </section>
}
