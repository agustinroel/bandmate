<mat-card
  class="song-card song-card--seed"
  tabindex="0"
  role="link"
  [attr.aria-label]="ariaLabel()"
  (keydown)="onCardKeyDown($event)"
  [routerLink]="['/library', work.id]"
>
  <div class="song-top">
    <div class="song-main">
      <div class="song-title-row">
        <div class="song-title" [title]="work.title">{{ work.title }}</div>

        <span class="bm-seed-pill">Library</span>

        <!-- ✅ Key: siempre visible -->
        <span class="bm-pill bm-pill--key" [class.is-missing]="!work.topArrangement?.key">
          Key {{ work.topArrangement?.key ?? '—' }}
        </span>
      </div>

      <div class="song-artist" [title]="work.artist">{{ work.artist || '—' }}</div>
    </div>
  </div>

  <!-- ✅ Meta: SIEMPRE -->
  <div class="song-meta">
    <!-- BPM -->
    <span class="bm-pill" [class.is-missing]="!work.topArrangement?.bpm">
      <mat-icon class="pill-ic">speed</mat-icon>
      <span>
        @if (work.topArrangement?.bpm) {
          {{ work.topArrangement?.bpm }} BPM
        } @else {
          —
        }
      </span>
    </span>

    <!-- Duration -->
    @let dur = durationLabel(work.topArrangement?.durationSec);
    <span class="bm-pill" [class.is-missing]="!dur">
      <mat-icon class="pill-ic">schedule</mat-icon>
      <span>
        @if (dur) {
          {{ dur }}
        } @else {
          —
        }
      </span>
    </span>

    <!-- Rating -->
    <span
      class="bm-pill bm-pill--rating"
      [class.is-missing]="!hasRating()"
      [matTooltip]="ratingTooltip()"
    >
      <mat-icon class="pill-ic">star</mat-icon>
      <span>{{ ratingAvgLabel() }}</span>
      @if (hasRating()) {
        <span class="opacity-75">({{ ratingCountLabel() }})</span>
      }
    </span>
  </div>

  <!-- Updated: siempre, con fallback -->
  <div class="song-updated opacity-75">
    <mat-icon class="updated-ic">history</mat-icon>
    Updated: {{ work.updatedAt || work.topArrangement?.updatedAt | date: 'MMM d, y' }}
  </div>
</mat-card>
