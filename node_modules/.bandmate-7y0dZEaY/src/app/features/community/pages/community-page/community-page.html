<!-- Premium Header -->
<div class="community-hero">
  <div class="hero-overlay"></div>
  <div class="container position-relative z-1">
    <div class="hero-icon">
      <mat-icon class="icon-lg text-accent">groups</mat-icon>
    </div>
    <h1 class="display-4 fw-bold mb-2 text-shadow">Community</h1>
    <p class="h5 opacity-75 fw-light mb-0">Connect with {{ profiles().length }} musicians</p>
  </div>
</div>

<div class="container main-content">
  <!-- Filters Card -->
  <div class="filters-card">
    <div class="d-flex flex-wrap gap-3 align-items-center">
      <!-- Search (Standard Mat Input) -->
      <mat-form-field
        appearance="outline"
        subscriptSizing="dynamic"
        class="flex-grow-1"
        style="min-width: 250px"
      >
        <mat-label>Search Name</mat-label>
        <mat-icon matPrefix class="text-secondary me-2">search</mat-icon>
        <input
          matInput
          [(ngModel)]="query"
          (keydown.enter)="load()"
          placeholder="Name or username..."
        />
      </mat-form-field>

      <!-- Filters -->
      <mat-form-field appearance="outline" subscriptSizing="dynamic" style="min-width: 150px">
        <mat-label>Instruments</mat-label>
        <mat-select [(ngModel)]="instruments" multiple>
          @for (inst of instrumentOptions; track inst) {
            <mat-option [value]="inst">{{ inst }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" subscriptSizing="dynamic" style="min-width: 150px">
        <mat-label>Genres</mat-label>
        <mat-select [(ngModel)]="genres" multiple>
          @for (genre of genreOptions; track genre) {
            <mat-option [value]="genre">{{ genre }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <div class="d-flex align-items-center gap-2 px-2 border-start h-100">
        <mat-checkbox [(ngModel)]="sings" color="primary">Sings</mat-checkbox>
      </div>

      <div class="d-flex gap-2 ms-auto">
        <button mat-flat-button color="primary" (click)="load()" [disabled]="loading()">
          Search
        </button>
        <button mat-stroked-button (click)="clearFilters()" [disabled]="loading()">Clear</button>
      </div>
    </div>
  </div>

  @if (loading()) {
    <div class="d-flex justify-content-center p-5 mt-5">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
  } @else if (error()) {
    <div class="mt-5">
      <bm-error-boundary />
    </div>
  } @else {
    <div class="row g-4 mt-2">
      @for (user of profiles(); track user.id) {
        <div class="col-12 col-md-6 col-lg-4">
          <a
            [routerLink]="['/u', user.username]"
            class="text-decoration-none text-reset h-100 d-block card-hover-wrapper"
          >
            <div class="premium-card">
              <!-- Card Header Gradient -->
              <div class="card-gradient"></div>

              <div class="p-4 pt-0 d-flex flex-column flex-grow-1 text-center">
                <!-- Avatar -->
                <div class="card-avatar-wrapper">
                  @if (user.avatar_url) {
                    <img [src]="user.avatar_url" (error)="user.avatar_url = null" alt="" />
                  } @else {
                    <div class="avatar-placeholder">
                      <mat-icon>person</mat-icon>
                    </div>
                  }
                </div>

                <!-- Info -->
                <div class="mt-3 mb-3">
                  <h3 class="fw-bold mb-0 text-dark">{{ user.full_name || user.username }}</h3>
                  <div class="text-primary small fw-semibold mb-2">@{{ user.username }}</div>

                  @if (user.bio) {
                    <p class="small text-muted line-clamp-2 px-2">{{ user.bio }}</p>
                  } @else {
                    <p class="small text-muted opacity-50 fst-italic">No bio available</p>
                  }
                </div>

                <!-- Chips -->
                <div class="mt-auto d-flex gap-2 flex-wrap justify-content-center">
                  @for (inst of user.instruments || []; track inst) {
                    <span class="bm-chip-sm">{{ inst }}</span>
                  }
                  @if (!user.instruments?.length) {
                    <span class="text-muted small opacity-50">No instruments</span>
                  }
                </div>
              </div>
            </div>
          </a>
        </div>
      }

      @if (profiles().length === 0) {
        <div class="col-12 text-center p-5 opacity-50 mt-4">
          <mat-icon class="display-1 mb-3 text-secondary">search_off</mat-icon>
          <div class="h4 text-secondary">No musicians found</div>
          <p class="text-muted">Try adjusting your filters to see more results.</p>
        </div>
      }
    </div>
  }
</div>
